@page "/demo"
@rendermode InteractiveServer
<h3>Demo Page</h3>
@using Tewr.Blazor.FileReader
@using System.IO
@inject IFileReaderService FileReaderService
@inject ISnackbar Snackbar

<MudPaper Class="p-4">
    <!-- File Reader Section -->
    <input type="file" @ref="inputTypeFileElement" />
    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="ReadFile" Class="ml-2">Read File</MudButton>

    <!-- Snackbar Test Section -->
    <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="ShowSimpleSnackbar" Class="ml-2">
        Show Test Snackbar
    </MudButton>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="ShowPersistentSnackbar" Class="ml-2">
        Open Persistent Snackbar
    </MudButton>
    <MudButton Variant="Variant.Filled" Color="Color.Error" OnClick="HidePersistentSnackbar" Class="ml-2">
        Hide Persistent Snackbar
    </MudButton>

    @if (fileContent != null)
    {
        <MudText Typo="Typo.body1" Class="mt-4">File Content:</MudText>
        <MudPaper Class="p-2 mt-2">
            <pre>@fileContent</pre>
        </MudPaper>
    }
</MudPaper>

@code {
    private ElementReference inputTypeFileElement;
    private string? fileContent;
    private Snackbar? persistentSnackbar;

    private async Task ReadFile()
    {
        var files = await FileReaderService.CreateReference(inputTypeFileElement).EnumerateFilesAsync();
        foreach (var file in files)
        {
            // Retrieve file metadata
            var fileInfo = await file.ReadFileInfoAsync();
            string fileName = fileInfo.Name;

            // Open the file as a stream
            await using Stream stream = await file.OpenReadAsync();
            using StreamReader reader = new StreamReader(stream);
            fileContent = await reader.ReadToEndAsync();

            // Show a success snackbar with the file name
            Snackbar.Add($"File '{fileName}' read successfully!", Severity.Success);

            // Break after processing the first file
            break;
        }
    }

    private void ShowSimpleSnackbar()
    {
        Snackbar.Add("This is a simple Snackbar from MudBlazor!", Severity.Info);
    }

    private void ShowPersistentSnackbar()
    {
        if (persistentSnackbar == null)
        {
            persistentSnackbar = Snackbar.Add("Persistent Snackbar - Click Hide to remove!", Severity.Warning, config =>
            {
                config.VisibleStateDuration = int.MaxValue;
            });
        }
    }

    private void HidePersistentSnackbar()
    {
        if (persistentSnackbar != null)
        {
            Snackbar.Remove(persistentSnackbar);
            persistentSnackbar = null;
        }
    }
}
