<!--EditSyncJobOverlay-->
@using WSyncPro.Core.Services
@using WSyncPro.Models.Jobs
@inject ISnackbar Snackbar
@inject IAppCache AppCache

<MudDialog>
     <DialogContent>
        <MudCard Style="max-width: 600px; margin: auto;" Outlined="true">
            <MudCardHeader>
                <MudText Typo="Typo.h6">Edit Sync Job</MudText>
            </MudCardHeader>
            <MudCardContent>
                <MudForm @ref="_form">
                    <MudTextField @bind-Value="_syncJob.Name" Label="Name" Variant="Variant.Outlined" Required="true" />
                    <MudTextField @bind-Value="_syncJob.Description" Label="Description" Variant="Variant.Outlined" />
                    <MudTextField @bind-Value="_syncJob.SrcDirectory" Label="Source Directory" Variant="Variant.Outlined" Required="true" />
                    <MudTextField @bind-Value="_syncJob.DstDirectory" Label="Destination Directory" Variant="Variant.Outlined" Required="true" />
                    <MudSwitch @bind-Value="_syncJob.KeepDirectories" Label="Keep Directories" Color="Color.Primary" />
                    <MudSelect T="JobStatus" @bind-Value="_syncJob.Status" Label="Status" Variant="Variant.Outlined">
                        @foreach (JobStatus status in Enum.GetValues(typeof(JobStatus)))

                        {
                            <MudSelectItem T="JobStatus" Value="@status">@status</MudSelectItem>
                        }
                    </MudSelect>
                </MudForm>
            </MudCardContent>
            <MudCardActions>
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SaveSyncJob">Save</MudButton>
                <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="Cancel">Cancel</MudButton>
            </MudCardActions>
        </MudCard>
    </DialogContent>

</MudDialog>

@code {
    private MudForm _form;

    private SyncJob _syncJob;



    [CascadingParameter] private MudDialogInstance MudDialog { get; set; }



    [Parameter] public SyncJob SyncJob { get; set; }



    protected override void OnInitialized()

    {

        _syncJob = new SyncJob

            {

                Id = SyncJob.Id,

                Name = SyncJob.Name,

                Description = SyncJob.Description,

                SrcDirectory = SyncJob.SrcDirectory,

                DstDirectory = SyncJob.DstDirectory,

                KeepDirectories = SyncJob.KeepDirectories,

                Status = SyncJob.Status,

                FilterParams = SyncJob.FilterParams

            };

    }



    private async Task SaveSyncJob()

    {

        await _form.Validate();

        if (_form.IsValid)

        {

            var updated = await AppCache.UpdateSyncJob(_syncJob);

            if (updated)

            {

                MudDialog.Close(DialogResult.Ok(true));

            }

            else

            {

                Snackbar.Add("Failed to update sync job.", Severity.Error);

            }

        }

        else

        {

            Snackbar.Add("Please fill in all required fields.", Severity.Warning);

        }

    }



    private void Cancel()

    {

        MudDialog.Cancel();

    }
}
